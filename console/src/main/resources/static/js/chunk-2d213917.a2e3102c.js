(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d213917"],{acdc:function(e,t,o){"use strict";o.r(t);var n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("base-component",[o("Breadcrumb",{style:{margin:"15px 0 15px 185px",position:"fixed"}},[o("BreadcrumbItem",{attrs:{to:"/home"}},[e._v("首页")]),o("BreadcrumbItem",{attrs:{to:"/drcclusters"}},[e._v("DRC集群")])],1),o("Content",{staticClass:"content",style:{padding:"10px",background:"#fff",margin:"50px 0 1px 185px",zIndex:"1"}},[o("div",{staticStyle:{padding:"1px 1px"}},[o("Table",{attrs:{stripe:"",columns:e.columns,data:e.dataWithPage,border:"","span-method":e.handleSpan},scopedSlots:e._u([{key:"action",fn:function(t){var n=t.row,a=t.index;return[o("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"success",size:"small"},on:{click:function(t){return e.checkConfig(n,a)}}},[e._v("查看")]),o("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(t){return e.goToLink(n,a)}}},[e._v("修改")]),o("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"error",size:"small"},on:{click:function(t){return e.previewRemoveConfig(n,a)}}},[e._v("删除")])]}}])}),o("div",{staticStyle:{"text-align":"center",margin:"16px 0"}},[o("Page",{attrs:{transfer:!0,total:e.total,current:e.current,"page-size":e.size,"show-sizer":"","show-elevator":""},on:{"update:current":function(t){e.current=t},"on-page-size-change":e.handleChangeSize}})],1)],1),o("Modal",{attrs:{title:"DRC配置",width:"1200px"},model:{value:e.cluster.modal.config,callback:function(t){e.$set(e.cluster.modal,"config",t)},expression:"cluster.modal.config"}},[o("Form",{staticStyle:{width:"100%"}},[o("FormItem",{attrs:{label:"集群配置"}},[o("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:e.cluster.config,callback:function(t){e.$set(e.cluster,"config",t)},expression:"cluster.config"}})],1)],1)],1),o("Modal",{attrs:{title:"删除DRC配置",width:"1200px"},on:{"on-ok":e.removeConfig,"on-cancel":e.clearRemoveConfig},model:{value:e.cluster.modal.remove,callback:function(t){e.$set(e.cluster.modal,"remove",t)},expression:"cluster.modal.remove"}},[o("Form",{staticStyle:{width:"100%"}},[o("FormItem",{attrs:{label:"确认删除以下双向复制吗？"}},[o("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:e.cluster.config,callback:function(t){e.$set(e.cluster,"config",t)},expression:"cluster.config"}})],1)],1)],1)],1)],1)},a=[],s=(o("4160"),o("caad"),o("c975"),o("fb6a"),o("a434"),o("d3b7"),o("159b"),o("2909")),r={data:function(){var e=this;return{switchOneInfo:{},cluster:{config:"",mhaAToBeRemoved:"",mhaBToBeRemoved:"",modal:{config:!1,remove:!1}},columns:[{title:"序号",width:75,align:"center",render:function(t,o){return t("span",o.index+1+(e.current-1)*e.size)}},{title:"集群A",key:"srcMha"},{title:"集群B",key:"destMha"},{title:"状态",key:"drcEstablishStatus",width:100,align:"center",render:function(e,t){var o=t.row,n=60===o.drcEstablishStatus?"blue":"volcano",a=60===o.drcEstablishStatus?"已接入":"未接入";return e("Tag",{props:{color:n}},a)}},{title:"监控",key:"monitorSwitch",align:"center",render:function(t,o){var n=o.row;return t("i-switch",{props:{size:"large",value:1===n.monitorSwitch,beforeChange:e.handleBeforeChange},scopedSlots:{open:function(){return t("span","开启")},close:function(){return t("span","关闭")}},on:{"on-change":function(){e.switchMonitor(n)}},nativeOn:{mousedown:function(){e.switchOneInfo={monitorSwitch:n.monitorSwitch}}}})}},{title:"操作",slot:"action",align:"center"}],mhaGroups:[],total:0,current:1,size:10,mergeColData:[]}},computed:{dataWithPage:function(){var e=this.mhaGroups,t=this.mergeColData,o=this.current*this.size-this.size,n=o+this.size;n>=this.total&&(n=this.total);for(var a=o;a<n;a++)t[a]+a>n?e[a].mergeCol=n-a:e[a].mergeCol=t[a];if(o>=this.size)for(var r=o-this.size;r<o;r++)if(t[r]+r>o){e[o].mergeCol=t[r]+r-o;break}return Object(s["a"])(e).slice(o,n)}},methods:{handleSpan:function(e){var t=e.row,o=(e.column,e.rowIndex,e.columnIndex);if(1===o){var n=0===t.mergeCol?0:t.mergeCol,a=0===t.mergeCol?0:1;return[n,a]}},assembleData:function(e){var t=this,o=[];e.forEach((function(e){o.includes(e.srcMha)||o.push(e.srcMha)}));var n=[];o.forEach((function(e){n.push({srcMha:e,num:0})})),e.forEach((function(e){n.forEach((function(t){e.srcMha===t.srcMha&&t.num++}))})),e.forEach((function(e){n.forEach((function(n){e.srcMha===n.srcMha&&(o.includes(e.srcMha)?(e.mergeCol=n.num,t.mergeColData.push(e.mergeCol),o.splice(o.indexOf(n.srcMha),1)):(e.mergeCol=0,t.mergeColData.push(e.mergeCol)))}))}));var a=e;this.mhaGroups=a,console.log("assemble")},getMhaGroups:function(){var e=this;this.axios.get("/api/drc/v1/meta/orderedGroups/all").then((function(t){e.mhaGroups=t.data.data,e.total=e.mhaGroups.length,e.assembleData(e.mhaGroups)}))},handleChangeSize:function(e){this.size=e},goToLink:function(e,t){console.log("go to change config for "+e.srcMha+" and "+e.destMha),this.$router.push({path:"/access",query:{step:"3",clustername:e.srcMha,newclustername:e.destMha}})},checkConfig:function(e,t){var o=this;console.log(e.srcMha),console.log(e.destMha),this.$Spin.show({render:function(e){return e("div",[e("Icon",{class:"demo-spin-icon-load",props:{size:18}}),e("div","请稍等...")])}}),this.axios.get("/api/drc/v1/meta/config/mhas/"+e.srcMha+","+e.destMha).then((function(e){var t=e.data.data;console.log(t),o.cluster.config=t,o.$Spin.hide(),o.cluster.modal.config=!0}))},previewRemoveConfig:function(e,t){var o=this;console.log(e.srcMha),console.log(e.destMha),this.cluster.mhaAToBeRemoved=e.srcMha,this.cluster.mhaBToBeRemoved=e.destMha,this.$Spin.show({render:function(e){return e("div",[e("Icon",{class:"demo-spin-icon-load",props:{size:18}}),e("div","请稍等...")])}}),this.axios.get("/api/drc/v1/meta/config/mhas/"+e.srcMha+","+e.destMha).then((function(e){var t=e.data.data;console.log(t),o.cluster.config=t,o.$Spin.hide(),o.cluster.modal.remove=!0}))},removeConfig:function(){var e=this;console.log("mhaAToBeRemoved",this.cluster.mhaAToBeRemoved),console.log("mhaBToBeRemoved",this.cluster.mhaBToBeRemoved),this.$Spin.show({render:function(e){return e("div",[e("Icon",{class:"demo-spin-icon-load",props:{size:18}}),e("div","请稍等...")])}}),this.axios.delete("/api/drc/v1/meta/config/remove/mhas/"+this.cluster.mhaAToBeRemoved+","+this.cluster.mhaBToBeRemoved).then((function(t){var o=t.data.data;console.log(o),o&&location.reload(),e.$Spin.hide()})),this.clearRemoveConfig()},clearRemoveConfig:function(){console.log("clear mhaAToBeRemoved",this.cluster.mhaAToBeRemoved),console.log("clear mhaBToBeRemoved",this.cluster.mhaBToBeRemoved),this.cluster.mhaAToBeRemoved="",this.cluster.mhaBToBeRemoved=""},moreOperation:function(e){this.$router.push({name:"incrementDataConsistencyCheck",query:{clusterA:e.srcMha,clusterB:e.destMha}})},handleBeforeChange:function(){var e=this;return console.log("handleBeforeChange:",this.switchOneInfo),new Promise((function(t){e.$Modal.confirm({title:"切换确认",content:"您确认要切换开关状态吗？",onOk:function(){t()}})}))},switchMonitor:function(e){var t=[];t.push(e.mhaGroupId);var o=0===e.monitorSwitch?"on":"off";this.switchMonitors(t,o)},switchMonitors:function(e,t){var o=this;console.log(e),this.axios.post("/api/drc/v1/monitor/switches/"+t,{mhaGroupIds:e}).then((function(e){0===e.data.status?(console.log(t),"on"===t?o.$Message.info("监控开启成功"):o.$Message.info("监控关闭成功")):o.$Message.info("监控操作失败"),o.getMhaGroups()}))}},created:function(){this.getMhaGroups()}},i=r,c=o("2877"),l=Object(c["a"])(i,n,a,!1,null,null,null);t["default"]=l.exports}}]);
//# sourceMappingURL=chunk-2d213917.a2e3102c.js.map