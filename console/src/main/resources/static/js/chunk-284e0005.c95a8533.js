(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-284e0005"],{"159b":function(e,t,a){var r=a("da84"),s=a("fdbc"),l=a("17c2"),n=a("9112");for(var o in s){var i=r[o],d=i&&i.prototype;if(d&&d.forEach!==l)try{n(d,"forEach",l)}catch(c){d.forEach=l}}},"17c2":function(e,t,a){"use strict";var r=a("b727").forEach,s=a("a640"),l=a("ae40"),n=s("forEach"),o=l("forEach");e.exports=n&&o?[].forEach:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}},"3c50":function(e,t,a){},4160:function(e,t,a){"use strict";var r=a("23e7"),s=a("17c2");r({target:"Array",proto:!0,forced:[].forEach!=s},{forEach:s})},5899:function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(e,t,a){var r=a("1d80"),s=a("5899"),l="["+s+"]",n=RegExp("^"+l+l+"*"),o=RegExp(l+l+"*$"),i=function(e){return function(t){var a=String(r(t));return 1&e&&(a=a.replace(n,"")),2&e&&(a=a.replace(o,"")),a}};e.exports={start:i(1),end:i(2),trim:i(3)}},7156:function(e,t,a){var r=a("861d"),s=a("d2bb");e.exports=function(e,t,a){var l,n;return s&&"function"==typeof(l=t.constructor)&&l!==a&&r(n=l.prototype)&&n!==a.prototype&&s(e,n),e}},"8f16":function(e,t,a){"use strict";a("3c50")},"93f4":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("base-component",[a("Breadcrumb",{style:{margin:"15px 0 15px 185px",position:"fixed"}},[a("BreadcrumbItem",{attrs:{to:"/home"}},[e._v("首页")]),a("BreadcrumbItem",{attrs:{to:"/access"}},[e._v("搭建DRC")])],1),a("Content",{staticClass:"content",style:{padding:"10px",background:"#ffffff",margin:"50px 0 1px 185px",zIndex:"1",top:"500px"}},[[a("Steps",{staticStyle:{width:"90%","margin-left":"50px","margin-bottom":"15px","margin-top":"50px"},attrs:{current:e.current}},[a("Step",{style:{cursor:"pointer"},attrs:{title:"新建集群",content:"新建复制集群"},nativeOn:{click:function(t){return e.jumpTo(0)}}}),a("Step",{style:{cursor:"pointer"},attrs:{title:"断开复制",content:"查看复制状态/断开复制连接"},nativeOn:{click:function(t){return e.jumpTo(1)}}}),a("Step",{style:{cursor:"pointer"},attrs:{title:"生成分机房域名",content:"生成新/源集群两侧域名"},nativeOn:{click:function(t){return e.jumpTo(2)}}}),a("Step",{style:{cursor:"pointer"},attrs:{title:"建立双向复制",content:"配置Replicator和Applier建立集群双向复制"},nativeOn:{click:function(t){return e.jumpTo(3)}}}),a("Step",{style:{cursor:"pointer"},attrs:{title:"录入DalCluster",content:"新集群db录入dal cluster"},nativeOn:{click:function(t){return e.jumpTo(4)}}}),a("Step",{style:{cursor:"pointer"},attrs:{title:"完成",content:"已完成DRC接入"},nativeOn:{click:function(t){return e.jumpTo(5)}}})],1)],0===e.current?a("build",e._b({on:{oldClusterChanged:e.updateOld,newClusterChanged:e.updateNew,newDrcZoneChanged:e.updateZone}},"build",e.clusterPair,!1)):e._e(),1===e.current?a("copy",e._b({on:{oldClusterChanged:e.updateOld}},"copy",e.clusterPair,!1)):e._e(),2===e.current?a("dns",e._b({on:{envChanged:e.updateEnv,oldClusterChanged:e.updateOld}},"dns",e.clusterPair,!1)):e._e(),3===e.current?a("drc",e._b({on:{envChanged:e.updateEnv,oldClusterChanged:e.updateOld}},"drc",e.clusterPair,!1)):e._e(),4===e.current?a("dal",e._b({on:{envChanged:e.updateEnv,oldClusterChanged:e.updateOld}},"dal",e.clusterPair,!1)):e._e(),5===e.current?a("complete"):e._e(),a("Divider"),a("div",{staticStyle:{padding:"1px 1px",height:"100px","margin-top":"75px"}},[a("div",[e.current>0?a("Button",{staticStyle:{position:"absolute",left:"465px"},attrs:{type:"primary"},on:{click:e.prev}},[e._v(" 上一步 ")]):e._e(),e.current<5?a("Button",{staticStyle:{position:"absolute",left:"790px"},attrs:{type:"primary"},on:{click:e.next}},[e._v(" 下一步 ")]):e._e()],1)])],2)],1)},s=[],l=(a("a9e3"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.hasResp?a("Alert",{staticStyle:{width:"65%","margin-left":"250px"},attrs:{type:e.status,"show-icon":""}},[e._v(" "+e._s(e.title)+" "),a("span",{attrs:{slot:"desc"},domProps:{innerHTML:e._s(e.message)},slot:"desc"})]):e._e(),a("Form",{ref:"build",staticStyle:{"margin-top":"50px"},attrs:{model:e.build,rules:e.ruleBuild,"label-width":250}},[a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"源集群名",prop:"oldClusterName"}},[a("Input",{attrs:{placeholder:"请输入源集群名"},on:{input:e.changeOld},model:{value:e.build.oldClusterName,callback:function(t){e.$set(e.build,"oldClusterName",t)},expression:"build.oldClusterName"}})],1),a("FormItem",{attrs:{label:"生成新集群机房区域",prop:"drcZone"}},[a("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"选择机房区域"},on:{input:e.changeNewZone},model:{value:e.build.drcZone,callback:function(t){e.$set(e.build,"drcZone",t)},expression:"build.drcZone"}},e._l(e.build.drcZoneList,(function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1)],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"BU名",prop:"bu"}},[a("Input",{attrs:{placeholder:"请输入BU名"},on:{input:e.changeBu},model:{value:e.build.bu,callback:function(t){e.$set(e.build,"bu",t)},expression:"build.bu"}})],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"DAL Cluster名",prop:"dalclustername"}},[a("Input",{attrs:{placeholder:"请输入DAL Cluster名"},on:{input:e.changeDalClusterName},model:{value:e.build.dalclustername,callback:function(t){e.$set(e.build,"dalclustername",t)},expression:"build.dalclustername"}})],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"appid",prop:"appid"}},[a("Input",{attrs:{placeholder:"请输入appid"},on:{input:e.changeAppId},model:{value:e.build.appid,callback:function(t){e.$set(e.build,"appid",t)},expression:"build.appid"}})],1),a("FormItem",[a("Button",{on:{click:function(t){return e.handleReset("build")}}},[e._v("重置")]),a("Button",{staticStyle:{"margin-left":"150px"},attrs:{type:"primary"},on:{click:function(t){return e.changeModal("build")}}},[e._v("新建集群")]),a("Modal",{attrs:{title:"创建新集群"},on:{"on-ok":function(t){return e.postBuild("build")}},model:{value:e.build.modal,callback:function(t){e.$set(e.build,"modal",t)},expression:"build.modal"}},[a("p",[e._v('确定创建新集群 "'+e._s(e.build.oldClusterName+e.build.drcZone)+'" 吗？并且设置BU/DAL Cluster/appid为 "'+e._s(e.build.bu)+'"/"'+e._s(e.build.dalclustername)+'"/"'+e._s(e.build.appid)+'"')])])],1)],1)],1)}),n=[],o={name:"build",props:{oldClusterName:String,newClusterName:String},data:function(){return{status:"",title:"",message:"",hasResp:!1,build:{modal:!1,oldClusterName:this.oldClusterName,newClusterName:this.newClusterName,bu:"",dalclustername:"",appid:"",drcZone:"",drcZoneList:[{value:"shaoy",label:"上海欧阳"},{value:"shaxy",label:"上海新源"},{value:"sharb",label:"上海日版"},{value:"shajq",label:"上海金桥"},{value:"shafq",label:"上海福泉"},{value:"shajz",label:"上海金钟"},{value:"ntgxh",label:"南通星湖大道"},{value:"shali",label:"上海阿里"},{value:"fraaws",label:"法兰克福AWS"},{value:"sinibuaws",label:"IBU-VPC"}]},ruleBuild:{oldClusterName:[{required:!0,message:"源集群名不能为空",trigger:"blur"}],drcZone:[{required:!0,message:"选择新建集群区域",trigger:"change"}],bu:[{required:!0,message:"BU名不能为空",trigger:"blur"}],dalclustername:[{required:!0,message:"DAL Cluster名不能为空",trigger:"blur"}],appid:[{required:!0,message:"cluster appid不能为空",trigger:"blur"}]}}},methods:{postBuild:function(e){var t=this,a=this;a.$refs[e].validate((function(e){e?(t.start(),t.hasResp=!1,a.axios.post("/api/drc/v1/access/mhaV2",{clustername:t.build.oldClusterName,drczone:t.build.drcZone,bu:t.build.bu,dalclustername:t.build.dalclustername,appid:t.build.appid}).then((function(e){a.hasResp=!0,"T"===e.data.data.status?(a.status="success",a.title="集群创建完成!",a.message="新集群名为："+e.data.data.drcCluster,a.$emit("newClusterChanged",e.data.data.drcCluster)):"W"===e.data.data.status?(a.status="establishing",t.title="集群创建中..."):(a.status="error",a.title="集群创建失败!"),t.finish()}))):a.$Message.error("仍有必填项未填!")}))},handleReset:function(e){this.$refs[e].resetFields()},changeOld:function(){this.$emit("oldClusterChanged",this.build.oldClusterName)},changeNewZone:function(){this.$emit("newDrcZoneChanged",this.build.drcZone)},changeBu:function(){this.$emit("buChanged",this.build.bu)},changeDalClusterName:function(){this.$emit("dalclusternameChanged",this.build.dalclustername)},changeAppId:function(){this.$emit("appidChanged",this.build.appid)},start:function(){this.$Loading.start()},finish:function(){this.$Loading.finish()},error:function(){this.$Loading.error()},changeModal:function(e){var t=this;this.$refs[e].validate((function(e){e?t.build.modal=!0:t.$Message.error("仍有必填项未填!")}))}}},i=o,d=a("2877"),c=Object(d["a"])(i,l,n,!1,null,"7103dd48",null),u=c.exports,p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.hasResp?a("Alert",{staticStyle:{width:"65%","margin-left":"250px"},attrs:{type:e.status,"show-icon":""}},[e._v(" "+e._s(e.title)+" "),a("span",{attrs:{slot:"desc"},domProps:{innerHTML:e._s(e.message)},slot:"desc"})]):e._e(),a("Form",{ref:"copy",staticStyle:{"margin-top":"50px"},attrs:{model:e.copy,rules:e.ruleCopy,"label-width":250}},[a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"源集群名",prop:"oldClusterName"}},[a("Input",{attrs:{placeholder:"请输入源集群名"},on:{input:e.changeOld},model:{value:e.copy.oldClusterName,callback:function(t){e.$set(e.copy,"oldClusterName",t)},expression:"copy.oldClusterName"}})],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"新集群名",prop:"newClusterName"}},[a("Input",{attrs:{placeholder:"请输入新集群名"},model:{value:e.copy.newClusterName,callback:function(t){e.$set(e.copy,"newClusterName",t)},expression:"copy.newClusterName"}})],1),a("FormItem",[a("Button",{on:{click:function(t){return e.handleReset("copy")}}},[e._v("重置")]),a("br"),a("br"),a("Button",{attrs:{type:"primary"},on:{click:function(t){return e.checkCopy("copy")}}},[e._v("复制状态检测")]),a("Button",{staticStyle:{"margin-left":"50px"},attrs:{type:"error",disabled:e.disabledDisconnect},on:{click:function(t){return e.changeModal("copy")}}},[e._v("断开复制")]),a("Modal",{attrs:{title:"断开复制"},on:{"on-ok":function(t){return e.disconnect("copy")}},model:{value:e.copy.modal,callback:function(t){e.$set(e.copy,"modal",t)},expression:"copy.modal"}},[a("p",[e._v("确定断开复制连接吗？")])])],1)],1)],1)},m=[],h={name:"copy",props:{oldClusterName:String,newClusterName:String},data:function(){return{status:"",title:"",message:"",hasResp:!1,disabledDisconnect:!0,copy:{modal:!1,oldClusterName:this.oldClusterName,newClusterName:this.newClusterName},ruleCopy:{oldClusterName:[{required:!0,message:"源集群名不能为空",trigger:"blur"}],newClusterName:[{required:!0,message:"新集群名不能为空",trigger:"blur"}]}}},methods:{checkCopy:function(e){var t=this,a=this;a.$refs[e].validate((function(e){e?(t.start(),a.hasResp=!1,a.axios.post("/api/drc/v1/access/copystatus",{OriginalCluster:t.copy.oldClusterName,DrcCluster:t.copy.newClusterName,rplswitch:0}).then((function(e){a.hasResp=!0,"T"===e.data.data.status?(a.disabledDisconnect=!1,a.status="success",a.title="复制状态正常!"):(a.disabledDisconnect=!0,a.status="error",a.title="复制状态异常!"),a.message=e.data.data.message,t.finish()}))):a.$Message.error("仍有必填项未填!")}))},disconnect:function(e){var t=this,a=this;a.$refs[e].validate((function(e){e?(t.start(),a.hasResp=!1,a.axios.post("/api/drc/v1/access/copystatus",{OriginalCluster:t.copy.oldClusterName,DrcCluster:t.copy.newClusterName,rplswitch:1}).then((function(e){a.hasResp=!0,"T"===e.data.data.status?(a.status="success",a.title="断开复制成功!"):(a.status="error",a.title="断开复制失败!"),a.message=e.data.data.message,t.finish()}))):a.$Message.error("仍有必填项未填!")}))},handleReset:function(e){this.$refs[e].resetFields()},changeOld:function(){this.$emit("oldClusterChanged",this.copy.oldClusterName)},start:function(){this.$Loading.start()},finish:function(){this.$Loading.finish()},error:function(){this.$Loading.error()},changeModal:function(e){var t=this;this.$refs[e].validate((function(e){e?t.copy.modal=!0:t.$Message.error("仍有必填项未填!")}))}}},f=h,b=Object(d["a"])(f,p,m,!1,null,"3d271e1a",null),g=b.exports,v=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.hasResp?a("Alert",{staticStyle:{width:"65%","margin-left":"250px"},attrs:{type:e.status,"show-icon":""}},[e._v(" "+e._s(e.title)+" "),a("span",{attrs:{slot:"desc"},domProps:{innerHTML:e._s(e.message)},slot:"desc"})]):e._e(),a("Form",{ref:"dns",staticStyle:{"margin-top":"50px"},attrs:{model:e.dns,rules:e.ruleDns,"label-width":250}},[a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"源集群名",prop:"oldClusterName"}},[a("Input",{attrs:{placeholder:"请输入源集群名"},on:{input:e.changeOld},model:{value:e.dns.oldClusterName,callback:function(t){e.$set(e.dns,"oldClusterName",t)},expression:"dns.oldClusterName"}})],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"新集群名",prop:"newClusterName"}},[a("Input",{attrs:{placeholder:"请输入新集群名"},model:{value:e.dns.newClusterName,callback:function(t){e.$set(e.dns,"newClusterName",t)},expression:"dns.newClusterName"}})],1),a("FormItem",{attrs:{label:"选择环境",prop:"env"}},[a("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"选择环境"},on:{input:function(t){e.changeEnv(),e.getAllDbs()}},model:{value:e.dns.env,callback:function(t){e.$set(e.dns,"env",t)},expression:"dns.env"}},e._l(e.dns.envList,(function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1)],1),a("FormItem",{staticStyle:{width:"700px"},attrs:{label:"选择DB"}},[a("div",[a("Table",{ref:"selection",attrs:{"highlight-row":"",border:"",columns:e.dns.columns,data:e.dns.dbNames},on:{"on-selection-change":e.changeSelection},model:{value:e.dns.selectedDbs,callback:function(t){e.$set(e.dns,"selectedDbs",t)},expression:"dns.selectedDbs"}})],1)]),a("FormItem",{attrs:{label:"需要读域名",prop:"needread"}},[a("i-switch",{model:{value:e.dns.needread,callback:function(t){e.$set(e.dns,"needread",t)},expression:"dns.needread"}})],1),a("FormItem",[a("Button",{on:{click:function(t){return e.handleReset("dns")}}},[e._v("重置")]),a("Button",{staticStyle:{"margin-left":"150px"},attrs:{type:"primary"},on:{click:function(t){return e.changeModal("dns")}}},[e._v("确定提交")]),a("Modal",{attrs:{title:"生成分机房域名"},on:{"on-ok":function(t){return e.postDns("dns")}},model:{value:e.dns.modal,callback:function(t){e.$set(e.dns,"modal",t)},expression:"dns.modal"}},[a("p",[e._v('确定在 "'+e._s(e.dns.oldClusterName)+'" 和 "'+e._s(e.dns.newClusterName)+'" 集群中生成带区域信息的域名吗？')])])],1)],1)],1)},w=[],N=(a("4160"),a("d81d"),a("b0c0"),a("159b"),{name:"dns",props:{oldClusterName:String,newClusterName:String,env:String},data:function(){return{status:"",title:"",message:"",hasResp:!1,dns:{modal:!1,oldClusterName:this.oldClusterName,newClusterName:this.newClusterName,env:this.env,needread:!1,columns:[{type:"selection",width:60,align:"center"},{title:"DB名",key:"name"}],dbNames:[],selectedDbs:[],envList:[{value:"product",label:"PRODUCT"},{value:"fat",label:"FAT"},{value:"lpt",label:"LPT"},{value:"uat",label:"UAT"}]},ruleDns:{oldClusterName:[{required:!0,message:"源集群名不能为空",trigger:"blur"}],newClusterName:[{required:!0,message:"新集群名不能为空",trigger:"blur"}],env:[{required:!0,message:"环境不能为空",trigger:"blur"}]}}},methods:{postDns:function(e){var t=this,a=this;a.$refs[e].validate((function(e){if(e){t.start();var r=t.dns.selectedDbs.map((function(e){return e.name}));a.hasResp=!1,a.title="部署DNS成功!",a.status="success",a.message="",a.axios.post("/api/drc/v1/access/dns",{cluster:t.dns.oldClusterName,dbnames:String(r),env:t.dns.env,needread:t.dns.needread?1:0}).then((function(e){a.hasResp=!0,e.data.data.success?a.message+="DNS部署成功！<br/>集群名："+t.dns.oldClusterName+"<br/>提示信息："+e.data.data.content+"<hr/>":(a.status="error",a.title="部署DNS失败!",a.message+="DNS部署失败！<br/>集群名："+t.dns.oldClusterName+"<br/>提示信息："+e.data.data.content+"<hr/>"),t.finish()})),a.axios.post("/api/drc/v1/access/dns",{cluster:t.dns.newClusterName,dbnames:String(r),env:t.dns.env,needread:t.dns.needread?1:0}).then((function(e){a.hasResp=!0,e.data.data.success?a.message+="DNS部署成功！<br/>集群名："+t.dns.newClusterName+"<br/>提示信息："+e.data.data.content+"<hr/>":(a.status="error",a.title="部署DNS失败!",a.message+="DNS部署失败！<br/>集群名："+t.dns.newClusterName+"<br/>提示信息："+e.data.data.content+"<hr/>"),t.finish()}))}else a.$Message.error("仍有必填项未填!")}))},handleReset:function(e){this.$refs[e].resetFields()},changeEnv:function(){this.$emit("envChanged",this.dns.env),this.getAllDbs()},getAllDbs:function(){var e=this;this.axios.get("/api/drc/v1/mha/dbnames/cluster/"+this.dns.oldClusterName+"/env/"+this.dns.env).then((function(t){console.log(t.data),e.dns.dbNames=[],t.data.data.forEach((function(t){return e.dns.dbNames.push({name:t})}))}))},changeSelection:function(){this.dns.selectedDbs=this.$refs.selection.getSelection()},changeOld:function(){this.getAllDbs(),this.$emit("oldClusterChanged",this.dns.oldClusterName)},start:function(){this.$Loading.start()},finish:function(){this.$Loading.finish()},error:function(){this.$Loading.error()},changeModal:function(e){var t=this;this.$refs[e].validate((function(e){e?t.dns.modal=!0:t.$Message.error("仍有必填项未填!")}))}},created:function(){this.getAllDbs()}}),C=N,y=Object(d["a"])(C,v,w,!1,null,"59591dc0",null),x=y.exports,I=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.hasResp?a("Alert",{staticStyle:{width:"65%","margin-left":"250px"},attrs:{type:e.status,"show-icon":""}},[e._v(" "+e._s(e.title)+" "),a("span",{attrs:{slot:"desc"},domProps:{innerHTML:e._s(e.message)},slot:"desc"})]):e._e(),a("Row",[a("i-col",{attrs:{span:"12"}},[a("Form",{ref:"drc1",staticStyle:{float:"left","margin-top":"50px"},attrs:{model:e.drc,rules:e.ruleDrc,"label-width":250}},[a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"源集群名",prop:"oldClusterName"}},[a("Input",{attrs:{placeholder:"请输入源集群名"},on:{input:e.changeOld},model:{value:e.drc.oldClusterName,callback:function(t){e.$set(e.drc,"oldClusterName",t)},expression:"drc.oldClusterName"}})],1),a("FormItem",{attrs:{label:"选择Replicator",prop:"replicator"}},[a("Select",{staticStyle:{width:"200px"},attrs:{multiple:"",placeholder:"选择源集群Replicator"},model:{value:e.drc.replicators.old,callback:function(t){e.$set(e.drc.replicators,"old",t)},expression:"drc.replicators.old"}},e._l(e.drc.replicatorlist.old,(function(t){return a("Option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("FormItem",{attrs:{label:"选择Applier",prop:"applier"}},[a("Select",{staticStyle:{width:"200px"},attrs:{multiple:"",placeholder:"选择源集群Applier"},model:{value:e.drc.appliers.old,callback:function(t){e.$set(e.drc.appliers,"old",t)},expression:"drc.appliers.old"}},e._l(e.drc.applierlist.old,(function(t){return a("Option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"设置includedDbs",prop:"oldIncludedDbs"}},[a("Input",{attrs:{placeholder:"请输入DB列表，以逗号分隔，不填默认为全部DB"},model:{value:e.drc.oldIncludedDbs,callback:function(t){e.$set(e.drc,"oldIncludedDbs",t)},expression:"drc.oldIncludedDbs"}})],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"配置同步对象",prop:"oldNameFilter"}},[a("Input",{attrs:{type:"textarea",autosize:!0,placeholder:"请输入表名，支持正则表达式，以逗号分隔，不填默认为全部表"},model:{value:e.drc.oldNameFilter,callback:function(t){e.$set(e.drc,"oldNameFilter",t)},expression:"drc.oldNameFilter"}})],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"配置表名映射",prop:"oldNameMapping"}},[a("Input",{attrs:{type:"textarea",autosize:!0,placeholder:"请输入映射关系，如：srcDb1.srcTable1,destDb1.destTable1;srcDb2.srcTable2,destDb2.destTable2"},model:{value:e.drc.oldNameMapping,callback:function(t){e.$set(e.drc,"oldNameMapping",t)},expression:"drc.oldNameMapping"}})],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"设置executedGtid"}},[a("Input",{attrs:{placeholder:"请输入源集群executedGtid，不填默认自动获取"},model:{value:e.drc.oldExecutedGtid,callback:function(t){e.$set(e.drc,"oldExecutedGtid",t)},expression:"drc.oldExecutedGtid"}})],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"设置applyMode"}},[a("Select",{staticStyle:{width:"200px"},model:{value:e.drc.oldApplyMode,callback:function(t){e.$set(e.drc,"oldApplyMode",t)},expression:"drc.oldApplyMode"}},e._l(e.applyModeList,(function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1)],1)],1)],1),a("i-col",{attrs:{span:"12"}},[a("Form",{ref:"drc2",staticStyle:{float:"left","margin-top":"50px"},attrs:{model:e.drc,rules:e.ruleDrc,"label-width":250}},[a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"新集群名",prop:"newClusterName"}},[a("Input",{attrs:{placeholder:"请输入新集群名"},on:{input:e.changeNew},model:{value:e.drc.newClusterName,callback:function(t){e.$set(e.drc,"newClusterName",t)},expression:"drc.newClusterName"}})],1),a("FormItem",{attrs:{label:"选择Replicator",prop:"replicator"}},[a("Select",{staticStyle:{width:"200px"},attrs:{multiple:"",placeholder:"选择新集群Replicator"},model:{value:e.drc.replicators.new,callback:function(t){e.$set(e.drc.replicators,"new",t)},expression:"drc.replicators.new"}},e._l(e.drc.replicatorlist.new,(function(t){return a("Option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("FormItem",{attrs:{label:"选择Applier",prop:"applier"}},[a("Select",{staticStyle:{width:"200px"},attrs:{multiple:"",placeholder:"选择新集群Applier"},model:{value:e.drc.appliers.new,callback:function(t){e.$set(e.drc.appliers,"new",t)},expression:"drc.appliers.new"}},e._l(e.drc.applierlist.new,(function(t){return a("Option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"设置includedDbs",prop:"newIncludedDbs"}},[a("Input",{attrs:{placeholder:"请输入DB列表，以逗号分隔，不填默认全部DB"},model:{value:e.drc.newIncludedDbs,callback:function(t){e.$set(e.drc,"newIncludedDbs",t)},expression:"drc.newIncludedDbs"}})],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"配置同步对象",prop:"newNameFilter"}},[a("Input",{attrs:{type:"textarea",autosize:!0,placeholder:"请输入表名，支持正则表达式，以逗号分隔，不填默认为全部表"},model:{value:e.drc.newNameFilter,callback:function(t){e.$set(e.drc,"newNameFilter",t)},expression:"drc.newNameFilter"}})],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"配置表名映射",prop:"newNameMapping"}},[a("Input",{attrs:{type:"textarea",autosize:!0,placeholder:"请输入映射关系，如：srcDb1.srcTable1,destDb1.destTable1;srcDb2.srcTable2,destDb2.destTable2"},model:{value:e.drc.newNameMapping,callback:function(t){e.$set(e.drc,"newNameMapping",t)},expression:"drc.newNameMapping"}})],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"设置executedGtid"}},[a("Input",{attrs:{placeholder:"请输入新集群executedGtid，不填默认自动获取"},model:{value:e.drc.newExecutedGtid,callback:function(t){e.$set(e.drc,"newExecutedGtid",t)},expression:"drc.newExecutedGtid"}})],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"设置applyMode"}},[a("Select",{staticStyle:{width:"200px"},model:{value:e.drc.newApplyMode,callback:function(t){e.$set(e.drc,"newApplyMode",t)},expression:"drc.newApplyMode"}},e._l(e.applyModeList,(function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1)],1)],1)],1)],1),a("Form",{staticStyle:{"margin-top":"50px"},attrs:{"label-width":250}},[a("FormItem",[a("Button",{on:{click:function(t){e.handleReset("drc1"),e.handleReset("drc2")}}},[e._v("重置")]),a("br"),a("br"),a("Button",{attrs:{type:"primary"},on:{click:function(t){e.preCheckConfigure()}}},[e._v("提交")])],1),a("Modal",{attrs:{title:"确认配置信息",width:"900px"},on:{"on-ok":e.submitConfig},model:{value:e.drc.reviewModal,callback:function(t){e.$set(e.drc,"reviewModal",t)},expression:"drc.reviewModal"}},[a("Row",{attrs:{gutter:"5px"}},[a("i-col",{attrs:{span:"12"}},[a("Form",{staticStyle:{width:"80%"}},[a("FormItem",{attrs:{label:"源集群名"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:e.drc.oldClusterName,callback:function(t){e.$set(e.drc,"oldClusterName",t)},expression:"drc.oldClusterName"}})],1),a("FormItem",{attrs:{label:"源集群端Replicator"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:e.drc.replicators.old,callback:function(t){e.$set(e.drc.replicators,"old",t)},expression:"drc.replicators.old"}})],1),a("FormItem",{attrs:{label:"源集群端Applier"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:e.drc.appliers.old,callback:function(t){e.$set(e.drc.appliers,"old",t)},expression:"drc.appliers.old"}})],1),a("FormItem",{attrs:{label:"源集群端includedDbs"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:e.drc.oldIncludedDbs,callback:function(t){e.$set(e.drc,"oldIncludedDbs",t)},expression:"drc.oldIncludedDbs"}})],1),a("FormItem",{attrs:{label:"源集群端同步对象"}},[a("Input",{attrs:{type:"textarea",autosize:!0,readonly:""},model:{value:e.drc.oldNameFilter,callback:function(t){e.$set(e.drc,"oldNameFilter",t)},expression:"drc.oldNameFilter"}})],1),a("FormItem",{attrs:{label:"源集群端表名映射"}},[a("Input",{attrs:{type:"textarea",autosize:!0,readonly:""},model:{value:e.drc.oldNameMapping,callback:function(t){e.$set(e.drc,"oldNameMapping",t)},expression:"drc.oldNameMapping"}})],1),a("FormItem",{attrs:{label:"源集群端executedGtid"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:e.drc.oldExecutedGtid,callback:function(t){e.$set(e.drc,"oldExecutedGtid",t)},expression:"drc.oldExecutedGtid"}})],1),a("FormItem",{attrs:{label:"源集群端applyMode"}},[a("Select",{attrs:{disabled:""},model:{value:e.drc.oldApplyMode,callback:function(t){e.$set(e.drc,"oldApplyMode",t)},expression:"drc.oldApplyMode"}},e._l(e.applyModeList,(function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1)],1)],1)],1),a("i-col",{attrs:{span:"12"}},[a("Form",{staticStyle:{width:"80%"}},[a("FormItem",{attrs:{label:"新集群名"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:e.drc.newClusterName,callback:function(t){e.$set(e.drc,"newClusterName",t)},expression:"drc.newClusterName"}})],1),a("FormItem",{attrs:{label:"新集群端Replicator"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:e.drc.replicators.new,callback:function(t){e.$set(e.drc.replicators,"new",t)},expression:"drc.replicators.new"}})],1),a("FormItem",{attrs:{label:"新集群端Applier"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:e.drc.appliers.new,callback:function(t){e.$set(e.drc.appliers,"new",t)},expression:"drc.appliers.new"}})],1),a("FormItem",{attrs:{label:"新集群端includedDbs"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:e.drc.newIncludedDbs,callback:function(t){e.$set(e.drc,"newIncludedDbs",t)},expression:"drc.newIncludedDbs"}})],1),a("FormItem",{attrs:{label:"新集群端同步对象"}},[a("Input",{attrs:{type:"textarea",autosize:!0,readonly:""},model:{value:e.drc.newNameFilter,callback:function(t){e.$set(e.drc,"newNameFilter",t)},expression:"drc.newNameFilter"}})],1),a("FormItem",{attrs:{label:"新集群端表名映射"}},[a("Input",{attrs:{type:"textarea",autosize:!0,readonly:""},model:{value:e.drc.newNameMapping,callback:function(t){e.$set(e.drc,"newNameMapping",t)},expression:"drc.newNameMapping"}})],1),a("FormItem",{attrs:{label:"新集群端executedGtid"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:e.drc.newExecutedGtid,callback:function(t){e.$set(e.drc,"newExecutedGtid",t)},expression:"drc.newExecutedGtid"}})],1),a("FormItem",{attrs:{label:"新集群端applyMode"}},[a("Select",{attrs:{disabled:""},model:{value:e.drc.newApplyMode,callback:function(t){e.$set(e.drc,"newApplyMode",t)},expression:"drc.newApplyMode"}},e._l(e.applyModeList,(function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1)],1)],1)],1)],1)],1),a("Modal",{attrs:{title:"配置结果",width:"1200px"},model:{value:e.drc.resultModal,callback:function(t){e.$set(e.drc,"resultModal",t)},expression:"drc.resultModal"}},[a("Form",{staticStyle:{width:"100%"}},[a("FormItem",{attrs:{label:"集群配置"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:e.result,callback:function(t){e.result=t},expression:"result"}})],1)],1)],1),a("Modal",{attrs:{title:"存在一对多共用运行配置请确认",width:"900px"},on:{"on-ok":e.reviewConfigure},model:{value:e.drc.warnModal,callback:function(t){e.$set(e.drc,"warnModal",t)},expression:"drc.warnModal"}},[a("label",{staticStyle:{color:"black"}},[e._v("共用replicator配置的集群: ")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.drc.conflictMha,expression:"drc.conflictMha"}],domProps:{value:e.drc.conflictMha},on:{input:function(t){t.target.composing||e.$set(e.drc,"conflictMha",t.target.value)}}}),a("Divider"),a("div",[a("p",{staticStyle:{color:"red"}},[e._v("线上一对多replicator配置")]),a("ul",e._l(e.drc.replicators.share,(function(t){return a("ol",{key:t},[e._v(e._s(t))])})),0)]),a("Divider"),a("div",[a("p",{staticStyle:{color:"black"}},[e._v("修改后replicator配置")]),a("ul",e._l(e.drc.replicators.conflictCurrent,(function(t){return a("ol",{key:t},[e._v(e._s(t))])})),0)])],1)],1)],1)},M=[],S={name:"drc",props:{oldClusterName:String,newClusterName:String,env:String},data:function(){return{result:"",status:"",title:"",message:"",hasResp:!1,applyModeList:[{value:0,label:"SET_GTID (default)"},{value:1,label:"TRANSACTION_TABLE"}],drc:{reviewModal:!1,warnModal:!1,resultModal:!1,oldClusterName:this.oldClusterName,newClusterName:this.newClusterName,oldIncludedDbs:"",newIncludedDbs:"",oldNameFilter:"",oldNameMapping:"",newNameFilter:"",newNameMapping:"",oldExecutedGtid:"",newExecutedGtid:"",oldApplyMode:0,newApplyMode:0,env:this.env,needread:!1,columns:[{type:"selection",width:60,align:"center"},{title:"DB名",key:"name"}],dbNames:[],selectedDbs:[],envList:[{value:"product",label:"PRODUCT"},{value:"fat",label:"FAT"},{value:"lpt",label:"LPT"},{value:"uat",label:"UAT"}],replicatorlist:{old:[],new:[]},conflictMha:"",replicators:{old:[],new:[],share:[],conflictCurrent:[]},replicator:{},searchReplicatorIp:"",usedReplicatorPorts:"",applierlist:{old:[],new:[]},appliers:{old:[],new:[]},previewMeta:""},ruleDrc:{oldClusterName:[{required:!0,message:"源集群名不能为空",trigger:"blur"}],newClusterName:[{required:!0,message:"新集群名不能为空",trigger:"blur"}],env:[{required:!0,message:"环境不能为空",trigger:"blur"}],replicator:[{required:!0,message:"replicator不能为空",trigger:"blur"}],applier:[{required:!0,message:"applier不能为空",trigger:"blur"}]}}},methods:{handleReset:function(e){this.$refs[e].resetFields()},getResourcesInOld:function(){var e=this;this.axios.get("/api/drc/v1/meta/mhas/"+this.drc.oldClusterName+"/resources/all/types/R").then((function(t){console.log(t.data),e.drc.replicatorlist.old=[],t.data.data.forEach((function(t){return e.drc.replicatorlist.old.push(t)}))})),this.axios.get("/api/drc/v1/meta/mhas/"+this.drc.oldClusterName+"/resources/all/types/A").then((function(t){console.log(t.data),e.drc.applierlist.old=[],t.data.data.forEach((function(t){return e.drc.applierlist.old.push(t)}))}))},getResourcesInUseInOld:function(){var e=this;this.axios.get("/api/drc/v1/meta/resources/using/types/R?localMha="+this.drc.oldClusterName).then((function(t){console.log(e.drc.oldClusterName+" replicators "+t.data.data),e.drc.replicators.old=[],t.data.data.forEach((function(t){return e.drc.replicators.old.push(t)}))})),this.axios.get("/api/drc/v1/meta/resources/using/types/A?localMha="+this.drc.oldClusterName+"&remoteMha="+this.drc.newClusterName).then((function(t){console.log(e.drc.oldClusterName+" request "+e.drc.newClusterName+" appliers "+t.data.data),e.drc.appliers.old=[],t.data.data.forEach((function(t){return e.drc.appliers.old.push(t)}))})),this.axios.get("/api/drc/v1/meta/includeddbs?localMha="+this.drc.oldClusterName+"&remoteMha="+this.drc.newClusterName).then((function(t){console.log(e.drc.oldClusterName+" request "+e.drc.newClusterName+" includedbs "+t.data.data),e.drc.oldIncludedDbs=t.data.data})),this.axios.get("/api/drc/v1/meta/namefilter?localMha="+this.drc.oldClusterName+"&remoteMha="+this.drc.newClusterName).then((function(t){console.log(e.drc.oldClusterName+" request "+e.drc.newClusterName+" namefilter "+t.data.data),e.drc.oldNameFilter=t.data.data})),this.axios.get("/api/drc/v1/meta/namemapping?localMha="+this.drc.oldClusterName+"&remoteMha="+this.drc.newClusterName).then((function(t){console.log(e.drc.oldClusterName+" request "+e.drc.newClusterName+" namemapping "+t.data.data),e.drc.oldNameMapping=t.data.data})),this.axios.get("/api/drc/v1/meta/applymode?localMha="+this.drc.oldClusterName+"&remoteMha="+this.drc.newClusterName).then((function(t){console.log(e.drc.oldClusterName+" request "+e.drc.newClusterName+" applymode "+t.data.data),e.drc.oldApplyMode=t.data.data}))},getResourcesInNew:function(){var e=this;this.axios.get("/api/drc/v1/meta/mhas/"+this.drc.newClusterName+"/resources/all/types/R").then((function(t){console.log(t.data),e.drc.replicatorlist.new=[],t.data.data.forEach((function(t){return e.drc.replicatorlist.new.push(t)}))})),this.axios.get("/api/drc/v1/meta/mhas/"+this.drc.newClusterName+"/resources/all/types/A").then((function(t){console.log(t.data),e.drc.applierlist.new=[],t.data.data.forEach((function(t){return e.drc.applierlist.new.push(t)}))}))},getResourcesInUseInNew:function(){var e=this;this.axios.get("/api/drc/v1/meta/resources/using/types/R?localMha="+this.drc.newClusterName).then((function(t){console.log(e.drc.newClusterName+" replicators "+t.data.data),e.drc.replicators.new=[],t.data.data.forEach((function(t){return e.drc.replicators.new.push(t)}))})),this.axios.get("/api/drc/v1/meta/resources/using/types/A?localMha="+this.drc.newClusterName+"&remoteMha="+this.drc.oldClusterName).then((function(t){console.log(e.drc.newClusterName+" request "+e.drc.oldClusterName+" appliers "+t.data.data),e.drc.appliers.new=[],t.data.data.forEach((function(t){return e.drc.appliers.new.push(t)}))})),this.axios.get("/api/drc/v1/meta/includeddbs?localMha="+this.drc.newClusterName+"&remoteMha="+this.drc.oldClusterName).then((function(t){console.log(e.drc.newClusterName+" request "+e.drc.oldClusterName+" includedbs "+t.data.data),e.drc.newIncludedDbs=t.data.data})),this.axios.get("/api/drc/v1/meta/namefilter?localMha="+this.drc.newClusterName+"&remoteMha="+this.drc.oldClusterName).then((function(t){console.log(e.drc.newClusterName+" request "+e.drc.oldClusterName+" namefilter "+t.data.data),e.drc.newNameFilter=t.data.data})),this.axios.get("/api/drc/v1/meta/namemapping?localMha="+this.drc.newClusterName+"&remoteMha="+this.drc.oldClusterName).then((function(t){console.log(e.drc.newClusterName+" request "+e.drc.oldClusterName+" namemapping "+t.data.data),e.drc.newNameMapping=t.data.data})),this.axios.get("/api/drc/v1/meta/applymode?localMha="+this.drc.newClusterName+"&remoteMha="+this.drc.oldClusterName).then((function(t){console.log(e.drc.newClusterName+" request "+e.drc.oldClusterName+" applymode "+t.data.data),e.drc.newApplyMode=t.data.data}))},debug:function(){console.log("replicators: "+this.drc.replicatorlist),console.log("appliers: "+this.drc.applierlist)},searchUsedReplicatorPorts:function(){var e=this;this.axios.get("/api/drc/v1/meta/resources/ip/"+this.drc.searchReplicatorIp).then((function(t){console.log(t.data),e.drc.usedReplicatorPorts=[],t.data.data.forEach((function(t){return e.drc.usedReplicatorPorts.push(t)}))}))},changeSelection:function(){this.drc.selectedDbs=this.$refs.selection.getSelection()},changeOld:function(){this.$emit("oldClusterChanged",this.drc.oldClusterName),this.getResourcesInOld(),this.getResourcesInUseInOld()},changeNew:function(){this.$emit("newClusterChanged",this.drc.newClusterName),this.getResourcesInNew(),this.getResourcesInUseInNew()},start:function(){this.$Loading.start()},finish:function(){this.$Loading.finish()},error:function(){this.$Loading.error()},changeModal:function(e){var t=this;this.$refs[e].validate((function(e){e?t.drc.reviewModal=!0:t.$Message.error("仍有必填项未填!")}))},preCheckConfigure:function(){var e=this;console.log("preCheck"),this.axios.post("/api/drc/v1/meta/config/preCheck",{srcMha:this.drc.oldClusterName,destMha:this.drc.newClusterName,srcReplicatorIps:this.drc.replicators.old,srcApplierIps:this.drc.appliers.old,srcApplierIncludedDbs:this.drc.oldIncludedDbs,srcApplierApplyMode:this.drc.oldApplyMode,srcGtidExecuted:this.drc.oldExecutedGtid,destReplicatorIps:this.drc.replicators.new,destApplierIps:this.drc.appliers.new,destApplierIncludedDbs:this.drc.newIncludedDbs,destApplierApplyMode:this.drc.newApplyMode,destGtidExecuted:this.drc.newExecutedGtid}).then((function(t){var a=t.data.data;0===a.status?e.drc.reviewModal=!0:1===a.status?(e.drc.replicators.share=a.workingReplicatorIps,e.drc.replicators.conflictCurrent=a.conflictMha===e.oldClusterName?e.drc.replicators.old:e.drc.replicators.new,e.drc.conflictMha=a.conflictMha,e.drc.warnModal=!0):window.alert("config preCheck fail")}))},reviewConfigure:function(){this.drc.reviewModal=!0},submitConfig:function(){var e=this;console.log(this.drc.oldClusterName,this.drc.newClusterName),console.log(this.drc.replicators.old),console.log(this.drc.appliers.old),console.log(this.drc.oldIncludedDbs),console.log(this.drc.oldNameFilter),console.log(this.drc.oldNameMapping),console.log(this.drc.oldApplyMode),console.log(this.drc.oldExecutedGtid),console.log(this.drc.replicators.new),console.log(this.drc.appliers.new),console.log(this.drc.newIncludedDbs),console.log(this.drc.newNameFilter),console.log(this.drc.newNameMapping),console.log(this.drc.newApplyMode),console.log(this.drc.newExecutedGtid),this.axios.post("/api/drc/v1/meta/config",{srcMha:this.drc.oldClusterName,destMha:this.drc.newClusterName,srcReplicatorIps:this.drc.replicators.old,srcApplierIps:this.drc.appliers.old,srcApplierIncludedDbs:this.drc.oldIncludedDbs,srcApplierNameFilter:this.drc.oldNameFilter,srcApplierNameMapping:this.drc.oldNameMapping,srcApplierApplyMode:this.drc.oldApplyMode,srcGtidExecuted:this.drc.oldExecutedGtid,destReplicatorIps:this.drc.replicators.new,destApplierIps:this.drc.appliers.new,destApplierIncludedDbs:this.drc.newIncludedDbs,destApplierNameFilter:this.drc.newNameFilter,destApplierNameMapping:this.drc.newNameMapping,destApplierApplyMode:this.drc.newApplyMode,destGtidExecuted:this.drc.newExecutedGtid}).then((function(t){console.log(t.data),e.result=t.data.data,e.drc.reviewModal=!1,e.drc.resultModal=!0}))}},created:function(){this.getResourcesInOld(),this.getResourcesInUseInOld(),this.getResourcesInNew(),this.getResourcesInUseInNew()}},_=S,D=(a("8f16"),Object(d["a"])(_,I,M,!1,null,"426dc6a1",null)),$=D.exports,k=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.hasResp?a("Alert",{staticStyle:{width:"65%","margin-left":"250px"},attrs:{type:e.status,"show-icon":""}},[e._v(" "+e._s(e.title)+" "),a("span",{attrs:{slot:"desc"},domProps:{innerHTML:e._s(e.message)},slot:"desc"})]):e._e(),a("Form",{ref:"dal",staticStyle:{"margin-top":"50px"},attrs:{model:e.dal,rules:e.ruleDal,"label-width":250}},[a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"源集群名",prop:"oldClusterName"}},[a("Input",{attrs:{placeholder:"请输入源集群名"},on:{input:e.changeOld},model:{value:e.dal.oldClusterName,callback:function(t){e.$set(e.dal,"oldClusterName",t)},expression:"dal.oldClusterName"}})],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"新集群名",prop:"newClusterName"}},[a("Input",{attrs:{placeholder:"请输入新集群名"},model:{value:e.dal.newClusterName,callback:function(t){e.$set(e.dal,"newClusterName",t)},expression:"dal.newClusterName"}})],1),a("FormItem",{attrs:{label:"新集群机房区域",prop:"drcZone"}},[a("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"选择机房区域"},on:{input:e.getAllDbs},model:{value:e.dal.drcZone,callback:function(t){e.$set(e.dal,"drcZone",t)},expression:"dal.drcZone"}},e._l(e.dal.drcZoneList,(function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1)],1),a("FormItem",{attrs:{label:"选择环境",prop:"env"}},[a("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"选择环境"},on:{input:e.changeEnv},model:{value:e.dal.env,callback:function(t){e.$set(e.dal,"env",t)},expression:"dal.env"}},e._l(e.dal.envList,(function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1)],1),a("FormItem",{staticStyle:{width:"90%"},attrs:{label:"选择DAL集群"}},[a("div",[a("Table",{ref:"selection",attrs:{"highlight-row":"",border:"",columns:e.dal.columns,data:e.dal.dbNames},on:{"on-selection-change":e.changeSelection},scopedSlots:e._u([{key:"status",fn:function(t){var r=t.index;return[a("Tag",{attrs:{size:"large",color:e.dal.dbNames[r].status?"success":"default"}},[e._v(e._s(e.dal.dbNames[r].status?"已录入":"未录入"))])]}},{key:"is",fn:function(t){var r=t.index;return[a("Tag",{attrs:{size:"large",color:e.dal.dbNames[r].isShard?"warning":"primary"}},[e._v(e._s(e.dal.dbNames[r].isShard?"是":"否"))])]}},{key:"no",fn:function(t){var r=t.index;return[a("Tag",{attrs:{size:"large",color:"default"}},[e._v(e._s(e.dal.dbNames[r].shardStartNo))])]}}]),model:{value:e.dal.selectedDbs,callback:function(t){e.$set(e.dal,"selectedDbs",t)},expression:"dal.selectedDbs"}})],1)]),a("FormItem",[a("Button",{on:{click:function(t){return e.handleReset("dal")}}},[e._v("重置")]),a("Button",{staticStyle:{"margin-left":"150px"},attrs:{type:"primary"},on:{click:function(t){return e.changeModal("dal",1)}}},[e._v("新集群录入DAL Cluster")]),a("Modal",{attrs:{title:"录入DAL集群"},on:{"on-ok":function(t){return e.postDal("dal","instance")}},model:{value:e.dal.modal1,callback:function(t){e.$set(e.dal,"modal1",t)},expression:"dal.modal1"}},[a("p",[e._v("确定将所有已选的db录入dal cluster吗？")])])],1)],1)],1)},R=[],A={name:"dal",props:{oldClusterName:String,newClusterName:String,env:String,newDrcZone:String},data:function(){return{status:"",title:"",message:"",hasResp:!1,dal:{modal1:!1,modal2:!1,modal3:!1,oldClusterName:this.oldClusterName,newClusterName:this.newClusterName,env:this.env,drcZone:this.newDrcZone,columns:[{type:"selection",width:60,align:"center"},{title:"DB",minWidth:150,key:"name"},{title:"Dal Cluster",minWidth:150,key:"dalName"},{title:"录入状态",width:110,slot:"status"},{title:"是否分片",width:100,slot:"is"},{title:"分片起始",width:100,slot:"no"}],dbNames:[],envList:[{value:"product",label:"PRODUCT"},{value:"fat",label:"FAT"},{value:"lpt",label:"LPT"},{value:"uat",label:"UAT"}],drcZoneList:[{value:"shaoy",label:"上海欧阳"},{value:"shaxy",label:"上海新源"},{value:"sharb",label:"上海日版"},{value:"shajq",label:"上海金桥"},{value:"shafq",label:"上海福泉"},{value:"shajz",label:"上海金钟"},{value:"ntgxh",label:"南通星湖大道"},{value:"shali",label:"上海阿里"},{value:"fraaws",label:"法兰克福AWS"},{value:"sinibuaws",label:"IBU-VPC"}]},ruleDal:{dalClusterName:[{required:!0,message:"DAL集群名不能为空",trigger:"blur"}],oldClusterName:[{required:!0,message:"源集群名不能为空",trigger:"blur"}],newClusterName:[{required:!0,message:"新集群名不能为空",trigger:"blur"}],env:[{required:!0,message:"环境不能为空",trigger:"blur"}],drcZone:[{required:!0,message:"选择新建集群区域",trigger:"change"}]}}},methods:{postDal:function(e,t){var a=this,r=this;r.$refs[e].validate((function(e){e?function(){a.start();var e=a.dal.selectedDbs;r.hasResp=!1,r.message="",r.title="录入成功!",r.status="success";for(var s=function(s){r.axios.post("/api/drc/v1/access/clusters/env/"+r.dal.env+"/goal/"+t,{dalclustername:e[s].dalName,dbname:e[s].name,basedbname:e[s].basedbname,clustername:r.dal.newClusterName,isshard:e[s].isShard,shardstartno:e[s].isShard?parseInt(e[s].shardStartNo):0}).then((function(l){r.hasResp=!0,l.data.data.success?"instance"===t?r.message+="DAL集群录入成功！<br/>集群名："+r.dal.newClusterName+":"+e[s].dalName+"<br/>提示信息："+l.data.data.message+"<hr/>":"user"===t&&(r.message+="用户录入成功！<br/>集群名："+r.dal.newClusterName+":"+e[s].dalName+"<br/>提示信息："+l.data.data.message+"<hr/>"):(r.title="失败!",r.status="error","instance"===t?r.message+="DAL集群录入失败！<br/>集群名："+r.dal.newClusterName+":"+e[s].dalName+"<br/>提示信息："+l.data.data.message+"<hr/>":"user"===t&&(r.message+="用户录入失败！<br/>集群名："+r.dal.newClusterName+":"+e[s].dalName+"<br/>提示信息："+l.data.data.message+"<hr/>")),a.finish()}))},l=0;l<e.length;l++)s(l)}():r.$Message.error("仍有必填项未填!")}))},release:function(e){var t=this,a=this;a.$refs[e].validate((function(e){e?function(){t.start();var e=t.dal.selectedDbs;a.hasResp=!1,a.status="success",a.title="发布DAL集群成功!",a.message="";for(var r=function(r){a.axios.post("/api/drc/v1/access/clusters/clustername/"+e[r].dalName+"/env/"+a.dal.env+"/releases").then((function(s){a.hasResp=!0,200===s.data.data.status?a.message+="发布成功！<br/>集群名："+e[r].dalName+"<br/>提示信息："+s.data.data.message+"<hr/>":(a.status="error",a.title="发布DAL集群失败!",a.message+="发布失败！<br/>集群名："+e[r].dalName+"<br/>提示信息："+s.data.data.message+"<hr/>"),t.finish()}))},s=0;s<e.length;s++)r(s)}():a.$Message.error("仍有必填项未填!")}))},handleReset:function(e){this.$refs[e].resetFields()},changeEnv:function(){this.$emit("envChanged",this.dal.env),this.getAllDbs()},getAllDbs:function(){var e=this;this.axios.get("/api/drc/v1/mha/dbnames/dalnames/cluster/"+this.dal.oldClusterName+"/env/"+this.dal.env+"/zoneId/"+this.dal.drcZone).then((function(t){console.log(t.data),e.dal.dbNames=[],t.data.data.forEach((function(t){return e.dal.dbNames.push({name:t.dbname,basedbname:t.basedbname,dalName:t.dalname,isShard:t.isshard,shardStartNo:t.shardstartno,status:t.status})}))}))},changeSelection:function(){this.dal.selectedDbs=this.$refs.selection.getSelection()},changeOld:function(){this.getAllDbs(),this.$emit("oldClusterChanged",this.dal.oldClusterName)},changeIsShard:function(e){this.dal.dbNames[e].isshard||(this.dal.dbNames[e].shardStartNo=0)},start:function(){this.$Loading.start()},finish:function(){this.$Loading.finish()},error:function(){this.$Loading.error()},changeModal:function(e,t){var a=this;this.$refs[e].validate((function(e){if(e)switch(t){case 1:a.dal.modal1=!0;break;case 2:a.dal.modal2=!0;break;case 3:a.dal.modal3=!0;break}else a.$Message.error("仍有必填项未填!")}))}},created:function(){this.getAllDbs()}},F=A,L=Object(d["a"])(F,k,R,!1,null,"3d17b764",null),E=L.exports,T=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{"margin-top":"100px"}},[a("Card",{staticStyle:{"margin-left":"250px",width:"650px"}},[a("div",{staticStyle:{"text-align":"center"}},[a("h3",[e._v("已完成DRC搭建流程！")])])])],1)},O=[],G={name:"complete",data:function(){return{}},methods:{}},q=G,B=Object(d["a"])(q,T,O,!1,null,"5da27c86",null),P=B.exports,Z={components:{build:u,copy:g,drc:$,dns:x,dal:E,complete:P},data:function(){return{current:0,clusterPair:{oldClusterName:this.$route.query.clustername,newClusterName:this.$route.query.newclustername,env:"",oldZoneId:this.$route.query.zoneId,newDrcZone:""}}},methods:{jumpTo:function(e){this.current=e,this.hasResp=!1},next:function(){this.current=this.current+1,this.hasResp=!1},prev:function(){this.current=this.current-1,this.hasResp=!1},updateOld:function(e){this.clusterPair.oldClusterName=e},updateNew:function(e){this.clusterPair.newClusterName=e},updateZone:function(e){this.clusterPair.newDrcZone=e},updateEnv:function(e){this.clusterPair.env=e}},created:function(){var e=this.$route.query.step;"undefined"===typeof e?console.log("curStep undefined, do nothing"):this.jumpTo(Number(e))}},z=Z,U=Object(d["a"])(z,r,s,!1,null,"629545d4",null);t["default"]=U.exports},a640:function(e,t,a){"use strict";var r=a("d039");e.exports=function(e,t){var a=[][e];return!!a&&r((function(){a.call(null,t||function(){throw 1},1)}))}},a9e3:function(e,t,a){"use strict";var r=a("83ab"),s=a("da84"),l=a("94ca"),n=a("6eeb"),o=a("5135"),i=a("c6b6"),d=a("7156"),c=a("c04e"),u=a("d039"),p=a("7c73"),m=a("241c").f,h=a("06cf").f,f=a("9bf2").f,b=a("58a8").trim,g="Number",v=s[g],w=v.prototype,N=i(p(w))==g,C=function(e){var t,a,r,s,l,n,o,i,d=c(e,!1);if("string"==typeof d&&d.length>2)if(d=b(d),t=d.charCodeAt(0),43===t||45===t){if(a=d.charCodeAt(2),88===a||120===a)return NaN}else if(48===t){switch(d.charCodeAt(1)){case 66:case 98:r=2,s=49;break;case 79:case 111:r=8,s=55;break;default:return+d}for(l=d.slice(2),n=l.length,o=0;o<n;o++)if(i=l.charCodeAt(o),i<48||i>s)return NaN;return parseInt(l,r)}return+d};if(l(g,!v(" 0o1")||!v("0b1")||v("+0x1"))){for(var y,x=function(e){var t=arguments.length<1?0:e,a=this;return a instanceof x&&(N?u((function(){w.valueOf.call(a)})):i(a)!=g)?d(new v(C(t)),a,x):C(t)},I=r?m(v):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),M=0;I.length>M;M++)o(v,y=I[M])&&!o(x,y)&&f(x,y,h(v,y));x.prototype=w,w.constructor=x,n(s,g,x)}},b0c0:function(e,t,a){var r=a("83ab"),s=a("9bf2").f,l=Function.prototype,n=l.toString,o=/^\s*function ([^ (]*)/,i="name";!r||i in l||s(l,i,{configurable:!0,get:function(){try{return n.call(this).match(o)[1]}catch(e){return""}}})},d81d:function(e,t,a){"use strict";var r=a("23e7"),s=a("b727").map,l=a("1dde"),n=a("ae40"),o=l("map"),i=n("map");r({target:"Array",proto:!0,forced:!o||!i},{map:function(e){return s(this,e,arguments.length>1?arguments[1]:void 0)}})},fdbc:function(e,t){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}}}]);
//# sourceMappingURL=chunk-284e0005.c95a8533.js.map